{%extends "base/page.html"%}
{%block title%}Feature Matrix{%endblock%}

{% block extrahead %}
{{ block.super }}
<style>
table.matrix tr th,
table.matrix tr td {
    display: none;
}
table.matrix tr th:nth-child(1),
table.matrix tr td:nth-child(1) {
    display: table-cell;
}
{% for version in versions %}
body:has(input#toggle_{{ version.numtree|cut:"." }}:checked) table.matrix th:nth-child({{forloop.counter|add:1}}),
body:has(input#toggle_{{ version.numtree|cut:"." }}:checked) table.matrix td:nth-child({{forloop.counter|add:1}}) {
    display: table-cell;
}
{% endfor %}
</style>
{%endblock%}

{%block extrascript%}
<script type="text/javascript" src="/media/js/featurematrix.js?{{gitrev}}"></script>
{%endblock%}

{%block contents%}
<h1>Feature Matrix <i class="fas fa-th-list"></i></h1>
<p>
This table outlines which features were added in which version. To get more
information about a feature, click the link or hover the mouse pointer over
the text.
</p>
<h3>Groups</h3>
<ul>
{% for group in matrix.keys %}
  <li>
    <a href="#{{group|slugify}}">{{group}}</a>
  </li>
{% endfor %}
</ul>

<div class="row">
  <div id="feature-matrix-filter" class="col-8 offset-2 border">
    <form id="featurematrix_version_filter"><h5>Filter by version</h5>
      {% for version in versions %}
        <label for="toggle_{{ version.numtree|cut:"." }}">{{ version.numtree }}</label>
        <input type="checkbox" id="toggle_{{ version.numtree|cut:"." }}" class="featurematrix_version" {% if version.supported or version.testing %}checked{% endif %} value="{{ version.numtree }}" />
      {% endfor %}
      <hr id="featurematrix_version_divider" />
      <label for="hide_unchanged">Hide unchanged features</label><input type="checkbox" id="hide_unchanged" />
    </form>
  </div>
</div>

{% for group, features in matrix.items %}
  <h2>
    <a name="{{group|slugify}}">{{ group }}</a>
  </h2>
  <table class="table table-striped table-sm matrix">
    <thead>
      <tr>
        <th scope="col" width="30%">&nbsp;</th>
        {% for ver in versions %}
          <th scope="col">{{ver.numtree}}</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {%for feature in features%}
        <tr valign="top">
          <th scope="row" {%if feature.description %}title="{{ feature.description|truncatewords:15 }}"{% endif %}>
            {% if feature.description %}
              <a href="detail/{{ feature.name|slugify }}/">{{feature.name}}</a>
	    {% elif feature.url %}
              <a href="{{ feature.url }}">{{feature.name}}</a>
            {%else%}
              {{feature.name}}
            {%endif%}
          </th>
          {%for col in feature.columns%}
            <td class="fm_{{col}}"></td>
          {%endfor%}
        </tr>
      {%endfor%}
    </tbody>
  </table>
{% endfor %}
{%endblock%}
